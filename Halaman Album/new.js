var audioPlayer=function(){"use strict";function l(e){var t=s.progressBar.offsetLeft,r=s.progressBar.offsetTop,a={x:null,y:null};return"ontouchstart"in window?(a.x=e.clientX-t,a.y=e.clientY-r,a):e.offsetX||0===e.offsetX?(a.x=e.offsetX,a.y=e.offsetY,a):e.layerX||0===e.layerX?(a.x=e.layerX,a.y=e.layerY,a):void 0}var r=null,s={audio:document.getElementById("audio"),playerButtons:{largeToggleBtn:document.querySelector(".large-toggle-btn"),nextTrackBtn:document.querySelector(".next-track-btn"),previousTrackBtn:document.querySelector(".previous-track-btn"),smallToggleBtn:document.getElementsByClassName("small-toggle-btn")},progressBar:document.querySelector(".progress-box"),playListRows:document.getElementsByClassName("play-list-row"),trackInfoBox:document.querySelector(".track-info-box")},a=!1,i=s.progressBar.children[0].children[0].children[1],n=!1,o=function(e){window.addEventListener("mousemove",d,!0),audio.removeEventListener("timeupdate",m,!1),a=!0},u=function(e){var t,r;!0===a&&(t=parseFloat(audio.duration),e=parseFloat((r=e,e=document.querySelector(".progress-box"),(l(r).x-e.offsetLeft)/e.children[0].offsetWidth)),window.removeEventListener("mousemove",d,!0),audio.currentTime=t*e,audio.addEventListener("timeupdate",m,!1),a=!1)},d=function(e){var t=0,r=s.progressBar.offsetLeft,a=s.progressBar.children[0].children[0].children[1],n=i.offsetWidth,e=l(e).x,o=s.progressBar.children[0].offsetWidth-n;1<=(t=e-r)&&t<=o&&(a.style.left=t+".px"),t<0&&(a.style.left="0"),o<t&&(a.style.left=o+"px")},c=function(){s.audio.paused?(s.audio.play(),e(!0),document.title="â–¶ "+document.title):(s.audio.pause(),e(!1),document.title=document.title.substr(2))},p=function(){var e=s.audio.children[r-1].src;s.audio.setAttribute("src",e),s.audio.load(),n=!0,f(r,s.playListRows),t(r,s.playListRows),s.trackInfoBox.style.visibility="visible",c()},t=function(e,t){for(var r=0;r<t.length;r++)t[r].children[2].className="track-title";t[e-1].children[2].className="track-title active-track"},f=function(e,t){var r=document.querySelector(".player .info-box .track-info-box .track-title-text"),e=t[e-1].children[2].outerText;r.innerHTML=null,r.innerHTML=e,document.title=e},y=function(){parseInt(r),r=r===s.playListRows.length?1:r+1,n=!1,h(),p()},m=function(){var e=document.querySelector(".player .info-box .track-info-box .audio-time .current-time"),t=audio.currentTime,r=audio.duration,a=document.querySelector(".player .info-box .track-info-box .audio-time .duration"),t=g(t),r=g(r);e.innerHTML=null,e.innerHTML=t,a.innerHTML=null,a.innerHTML=r,B(audio),r=100*(r=audio).buffered.end(0)/r.duration,s.progressBar.children[0].children[0].children[0].style.width=r+"%"},g=function(e){var t=0,e=Math.floor(e);return(t=10<=(t=Math.floor(e/60))?t:"0"+t)+":"+(e=10<=(e=Math.floor(e%60))?e:"0"+e)},e=function(e){e?(s.playerButtons.largeToggleBtn.children[0].className="large-pause-btn",s.playerButtons.smallToggleBtn[r-1].children[0].className="small-pause-btn"):(s.playerButtons.largeToggleBtn.children[0].className="large-play-btn",s.playerButtons.smallToggleBtn[r-1].children[0].className="small-play-btn"),1===r?(s.playerButtons.previousTrackBtn.disabled=!0,s.playerButtons.previousTrackBtn.className="previous-track-btn disabled"):1<r&&r!==s.playListRows.length?(s.playerButtons.previousTrackBtn.disabled=!1,s.playerButtons.previousTrackBtn.className="previous-track-btn",s.playerButtons.nextTrackBtn.disabled=!1,s.playerButtons.nextTrackBtn.className="next-track-btn"):r===s.playListRows.length&&(s.playerButtons.nextTrackBtn.disabled=!0,s.playerButtons.nextTrackBtn.className="next-track-btn disabled")},B=function(){var e=parseFloat(s.audio.currentTime)/parseFloat(s.audio.duration)*(parseFloat(s.progressBar.offsetWidth)-parseFloat(i.offsetWidth));i.style.left=e+"px"},h=function(){var e=s.playerButtons.smallToggleBtn;s.playerButtons.largeToggleBtn.children[0].className="large-play-btn";for(var t=0;t<e.length;t++)"small-pause-btn"===e[t].children[0].className&&(e[t].children[0].className="small-play-btn")};return{initPlayer:function(){1!==r&&null!==r||(s.playerButtons.previousTrackBtn.disabled=!0);for(var e=0;e<s.playListRows.length;e++){var t=s.playerButtons.smallToggleBtn[e];s.playListRows[e].children[2].children[0].addEventListener("click",function(e){e.preventDefault();e=parseInt(this.parentNode.parentNode.getAttribute("data-track-row"));e!==r&&(h(),r=null,n=!1),!1===n?(r=parseInt(e),p()):c(this)},!1),t.addEventListener("click",function(e){e.preventDefault();e=parseInt(this.parentNode.getAttribute("data-track-row"));e!==r&&(h(),r=null,n=!1),!1===n?(r=parseInt(e),p()):c(this)},!1)}s.audio.addEventListener("timeupdate",m,!1),s.audio.addEventListener("ended",function(e){y()},!1),s.audio.addEventListener("error",function(e){switch(e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:alert("You aborted the video playback.");break;case e.target.error.MEDIA_ERR_NETWORK:alert("A network error caused the audio download to fail.");break;case e.target.error.MEDIA_ERR_DECODE:alert("The audio playback was aborted due to a corruption problem or because the video used features your browser did not support.");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:alert("The video audio not be loaded, either because the server or network failed or because the format is not supported.");break;default:alert("An unknown error occurred.")}trackLoaded=!1,h()},!1),s.playerButtons.largeToggleBtn.addEventListener("click",function(e){!1===n?(r=parseInt(1),p()):c()},!1),s.playerButtons.nextTrackBtn.addEventListener("click",function(e){!0!==this.disabled&&(r++,n=!1,h(),p())},!1),s.playerButtons.previousTrackBtn.addEventListener("click",function(e){!0!==this.disabled&&(r--,n=!1,h(),p())},!1),i.addEventListener("mousedown",o,!1),window.addEventListener("mouseup",u,!1)}}};(new audioPlayer).initPlayer();
