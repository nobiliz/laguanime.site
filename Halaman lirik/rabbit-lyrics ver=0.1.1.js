function RabbitLyrics(e){if(e.audioElement&&e.lyricsElement&&(this.audioElement=jQuery(e.audioElement),this.lyricsElement=jQuery(e.lyricsElement),!this.lyricsElement.data("lyricsEnabled"))){switch(e.size){case"tiny":case"medium":case"full":this.size=e.size;break;default:this.size="medium"}this.applySize().parseLyrics().enableLyrics()}}RabbitLyrics.prototype.applySize=function(){return this.lyricsElement.addClass(this.size),this},RabbitLyrics.prototype.parseLyrics=function(){var e=this.lyricsElement.text().trim().split("\n");this.lyricsElement.html("");for(var t=0,i=0;i<e.length;i++){var s=jQuery('<div class="line"></div>');this.lyricsElement.append(s);var a=e[i].trim(),n=a.match(/\[\d+:\d+\.\d+\]/g)||[],r=a.match(/^\[\d+:\d+\.\d+\]/g)||[],l=a.match(/\[\d+:\d+\.\d+\]$/g)||[];0<n.length&&this.lyricsElement.find(".no-end").removeClass("no-end").data("end",this.decodeTimeStamp(n[0])),2===n.length&&0<r.length&&0<l.length?(s.data("start",this.decodeTimeStamp(r[0])),s.data("end",this.decodeTimeStamp(l[0])),t=this.decodeTimeStamp(l[0])):1===n.length&&0<r.length?(s.data("start",this.decodeTimeStamp(r[0])).addClass("no-end"),t=this.decodeTimeStamp(r[0])):0<l.length?(s.data("start",t).data("end",this.decodeTimeStamp(l[0])),t=this.decodeTimeStamp(l[0])):s.html(a).data("start",t).addClass("no-end"),(a=a.replace(/\[\d+:\d+\.\d+\]/g,""))||(a="&nbsp;",s.data("start",999999).data("end",999999)),s.html(a)}return this.lyricsElement.find(".no-end").removeClass("no-end").data("end",999999),this},RabbitLyrics.prototype.enableLyrics=function(){var n=this;return this.lyrics=[],this.activeLyrics=[],this.lyricsElement.find(".line").each(function(){n.lyrics.push({start:jQuery(this).data("start"),end:jQuery(this).data("end"),element:jQuery(this)})}),this.lyricsElement.scrollTop(0),this.audioElement.bind("timeupdate",function(){var e=n.time=n.audioElement[0].currentTime,t=!1;n.activeLyrics=[];for(var i=0;i<n.lyrics.length;i++){var s=n.lyrics[i];s.start<e&&s.end>e?(s.element.hasClass("active")||(t=!0,s.element.addClass("active")),n.activeLyrics.push(s)):s.element.hasClass("active")&&(t=!0,s.element.removeClass("active"))}if("medium"===n.size&&t&&0<n.activeLyrics.length){var a=n.lyricsElement.scrollTop()+(n.activeLyrics[0].element.offset().top+n.activeLyrics[n.activeLyrics.length-1].element.offset().top)/2-n.lyricsElement.offset().top-n.lyricsElement.height()/2;n.lyricsElement.stop().animate({scrollTop:a},200)}}),this.lyricsElement.data("lyricsEnabled"),this},RabbitLyrics.prototype.decodeTimeStamp=function(e){var t=null;if(e){var i=e.match(/\[(\d+):(\d+\.\d+)\]/);3===i.length&&(t=60*parseInt(i[1])+parseFloat(i[2]))}return t},jQuery(function(){jQuery(".rabbit-lyrics").each(function(){var e=jQuery(jQuery(this).data("audio"));if(0!==e.length){var t=jQuery(this).data("size");new RabbitLyrics({audioElement:e,lyricsElement:this,size:t=t||"medium"})}})});
